<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enkana Fresh â€” Tech Stack</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #1a6b3a;
    --green-light: #2d9653;
    --green-pale: #e8f5ee;
    --gold: #c8922a;
    --gold-light: #f0b429;
    --cream: #faf7f0;
    --dark: #0f1a12;
    --mid: #2a3d2e;
    --gray: #6b7c6e;
    --border: #d4e8da;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--cream);
    font-family: 'Syne', sans-serif;
    color: var(--dark);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grain texture overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.4;
  }

  .page {
    position: relative;
    z-index: 1;
    max-width: 1100px;
    margin: 0 auto;
    padding: 48px 32px 80px;
  }

  /* Header */
  .header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 56px;
    padding-bottom: 32px;
    border-bottom: 2px solid var(--green);
  }

  .logo-area {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo-mark {
    width: 52px;
    height: 52px;
    background: var(--green);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
  }

  .brand-name {
    font-size: 28px;
    font-weight: 800;
    color: var(--green);
    line-height: 1;
    letter-spacing: -0.5px;
  }

  .brand-sub {
    font-size: 12px;
    font-weight: 600;
    color: var(--gray);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 4px;
    font-family: 'Space Mono', monospace;
  }

  .header-meta {
    text-align: right;
  }

  .version-tag {
    display: inline-block;
    background: var(--gold);
    color: white;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 4px;
    font-family: 'Space Mono', monospace;
    margin-bottom: 6px;
  }

  .header-desc {
    font-size: 12px;
    color: var(--gray);
    font-family: 'Space Mono', monospace;
  }

  /* Section title */
  .section-title {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gold);
    font-family: 'Space Mono', monospace;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* Architecture flow */
  .arch-flow {
    display: grid;
    grid-template-columns: 1fr 40px 1fr 40px 1fr 40px 1fr;
    align-items: center;
    gap: 0;
    margin-bottom: 48px;
    background: var(--dark);
    border-radius: 16px;
    padding: 28px 24px;
    position: relative;
    overflow: hidden;
  }

  .arch-flow::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(26,107,58,0.3) 0%, rgba(200,146,42,0.1) 100%);
    pointer-events: none;
  }

  .flow-node {
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    padding: 16px 12px;
    text-align: center;
    position: relative;
    z-index: 1;
    transition: all 0.2s;
  }

  .flow-node:hover {
    background: rgba(255,255,255,0.12);
    border-color: rgba(45,150,83,0.6);
    transform: translateY(-2px);
  }

  .flow-node .node-icon {
    font-size: 22px;
    margin-bottom: 8px;
    display: block;
  }

  .flow-node .node-label {
    font-size: 11px;
    font-weight: 700;
    color: white;
    letter-spacing: 0.5px;
  }

  .flow-node .node-sub {
    font-size: 9px;
    color: rgba(255,255,255,0.5);
    margin-top: 3px;
    font-family: 'Space Mono', monospace;
  }

  .flow-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--green-light);
    font-size: 18px;
    position: relative;
    z-index: 1;
  }

  /* Layer grid */
  .layers {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 48px;
  }

  .layer-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: all 0.2s;
  }

  .layer-card:hover {
    box-shadow: 0 8px 32px rgba(26,107,58,0.1);
    border-color: var(--green-light);
    transform: translateY(-2px);
  }

  .layer-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
  }

  .layer-card.frontend::before { background: linear-gradient(90deg, #3b82f6, #06b6d4); }
  .layer-card.backend::before { background: linear-gradient(90deg, var(--green), var(--green-light)); }
  .layer-card.intelligence::before { background: linear-gradient(90deg, #8b5cf6, #ec4899); }
  .layer-card.payments::before { background: linear-gradient(90deg, var(--gold), var(--gold-light)); }
  .layer-card.comms::before { background: linear-gradient(90deg, #10b981, #34d399); }
  .layer-card.devops::before { background: linear-gradient(90deg, #f59e0b, #ef4444); }

  .layer-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 18px;
  }

  .layer-icon {
    width: 38px;
    height: 38px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }

  .frontend .layer-icon { background: #eff6ff; }
  .backend .layer-icon { background: var(--green-pale); }
  .intelligence .layer-icon { background: #fdf4ff; }
  .payments .layer-icon { background: #fffbeb; }
  .comms .layer-icon { background: #ecfdf5; }
  .devops .layer-icon { background: #fff7ed; }

  .layer-title {
    font-size: 15px;
    font-weight: 800;
    color: var(--dark);
    letter-spacing: -0.3px;
  }

  .layer-category {
    font-size: 10px;
    color: var(--gray);
    font-family: 'Space Mono', monospace;
    text-transform: uppercase;
    letter-spacing: 1.5px;
  }

  .tech-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .tech-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .tech-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: var(--cream);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 3px 8px;
    font-size: 11px;
    font-weight: 700;
    color: var(--dark);
    font-family: 'Space Mono', monospace;
    white-space: nowrap;
    flex-shrink: 0;
    min-width: 120px;
  }

  .tech-desc {
    font-size: 12px;
    color: var(--gray);
    line-height: 1.5;
    padding-top: 2px;
  }

  /* Cost table */
  .cost-section {
    background: var(--dark);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 48px;
    position: relative;
    overflow: hidden;
  }

  .cost-section::before {
    content: '';
    position: absolute;
    top: -60px;
    right: -60px;
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, rgba(200,146,42,0.2) 0%, transparent 70%);
    pointer-events: none;
  }

  .cost-section .section-title {
    color: var(--gold-light);
  }

  .cost-section .section-title::after {
    background: rgba(255,255,255,0.1);
  }

  .cost-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }

  .cost-item {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 16px;
  }

  .cost-service {
    font-size: 11px;
    color: rgba(255,255,255,0.5);
    font-family: 'Space Mono', monospace;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }

  .cost-amount {
    font-size: 20px;
    font-weight: 800;
    color: white;
    line-height: 1;
  }

  .cost-period {
    font-size: 10px;
    color: rgba(255,255,255,0.4);
    font-family: 'Space Mono', monospace;
    margin-top: 3px;
  }

  .cost-total {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(200,146,42,0.15);
    border: 1px solid rgba(200,146,42,0.3);
    border-radius: 10px;
    padding: 16px 20px;
  }

  .cost-total-label {
    font-size: 13px;
    font-weight: 700;
    color: var(--gold-light);
    letter-spacing: 1px;
    text-transform: uppercase;
    font-family: 'Space Mono', monospace;
  }

  .cost-total-amount {
    font-size: 28px;
    font-weight: 800;
    color: white;
  }

  .cost-note {
    font-size: 11px;
    color: rgba(255,255,255,0.4);
    font-family: 'Space Mono', monospace;
    margin-top: 12px;
    text-align: center;
  }

  /* Data flow diagram */
  .dataflow {
    background: white;
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 48px;
  }

  .flow-diagram {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .flow-row {
    display: flex;
    align-items: center;
    gap: 0;
  }

  .flow-box {
    flex: 1;
    background: var(--green-pale);
    border: 1.5px solid var(--green);
    border-radius: 10px;
    padding: 12px 16px;
    text-align: center;
    font-size: 12px;
    font-weight: 700;
    color: var(--green);
    cursor: default;
    transition: all 0.15s;
  }

  .flow-box:hover {
    background: var(--green);
    color: white;
    transform: scale(1.03);
  }

  .flow-box.gold {
    background: #fffbeb;
    border-color: var(--gold);
    color: var(--gold);
  }

  .flow-box.gold:hover {
    background: var(--gold);
    color: white;
  }

  .flow-box.purple {
    background: #fdf4ff;
    border-color: #8b5cf6;
    color: #8b5cf6;
  }

  .flow-box.purple:hover {
    background: #8b5cf6;
    color: white;
  }

  .flow-box.dark {
    background: var(--dark);
    border-color: var(--dark);
    color: white;
  }

  .flow-box .fbox-sub {
    font-size: 9px;
    font-weight: 400;
    opacity: 0.7;
    font-family: 'Space Mono', monospace;
    margin-top: 2px;
  }

  .h-arrow {
    width: 28px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray);
    font-size: 14px;
  }

  .v-connector {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 24px;
    color: var(--gray);
    font-size: 14px;
    margin-left: calc(50% - 7px);
    width: fit-content;
  }

  .flow-cols {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin: 0;
  }

  /* Principles */
  .principles {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }

  .principle {
    padding: 20px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: white;
    position: relative;
    overflow: hidden;
  }

  .principle::after {
    content: attr(data-num);
    position: absolute;
    bottom: -10px;
    right: 10px;
    font-size: 72px;
    font-weight: 800;
    color: var(--green-pale);
    line-height: 1;
    font-family: 'Syne', sans-serif;
    pointer-events: none;
  }

  .principle-title {
    font-size: 13px;
    font-weight: 800;
    color: var(--dark);
    margin-bottom: 6px;
  }

  .principle-desc {
    font-size: 12px;
    color: var(--gray);
    line-height: 1.6;
    position: relative;
    z-index: 1;
  }

  /* Animations */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .page > * {
    animation: fadeUp 0.5s ease forwards;
  }

  .layer-card:nth-child(1) { animation-delay: 0.05s; }
  .layer-card:nth-child(2) { animation-delay: 0.1s; }
  .layer-card:nth-child(3) { animation-delay: 0.15s; }
  .layer-card:nth-child(4) { animation-delay: 0.2s; }
  .layer-card:nth-child(5) { animation-delay: 0.25s; }
  .layer-card:nth-child(6) { animation-delay: 0.3s; }

  /* Responsive */
  @media (max-width: 768px) {
    .layers { grid-template-columns: 1fr; }
    .cost-grid { grid-template-columns: repeat(2, 1fr); }
    .principles { grid-template-columns: 1fr; }
    .arch-flow { grid-template-columns: 1fr; }
    .flow-arrow { transform: rotate(90deg); }
    .header { flex-direction: column; gap: 16px; }
  }
</style>
</head>
<body>
<div class="page">

  <!-- Header -->
  <div class="header">
    <div class="logo-area">
      <div class="logo-mark">ğŸ„</div>
      <div>
        <div class="brand-name">Enkana Fresh</div>
        <div class="brand-sub">Full Infrastructure Stack</div>
      </div>
    </div>
    <div class="header-meta">
      <div class="version-tag">v2.0 â€” 2025</div>
      <div class="header-desc">Grass-fed Meat Delivery Â· Kenya & Uganda</div>
    </div>
  </div>

  <!-- Architecture Flow -->
  <div class="section-title">System Architecture</div>
  <div class="arch-flow">
    <div class="flow-node">
      <span class="node-icon">ğŸ“±</span>
      <div class="node-label">Customer</div>
      <div class="node-sub">WhatsApp / Web</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node" style="border-color: rgba(246,130,31,0.6);">
      <span class="node-icon">ğŸ›¡ï¸</span>
      <div class="node-label">Cloudflare</div>
      <div class="node-sub">CDN Â· WAF Â· DNS</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node">
      <span class="node-icon">âš¡</span>
      <div class="node-label">Next.js</div>
      <div class="node-sub">Static Export</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node">
      <span class="node-icon">ğŸ—„ï¸</span>
      <div class="node-label">Supabase</div>
      <div class="node-sub">DB + Functions</div>
    </div>
    <div class="flow-arrow">â†’</div>
    <div class="flow-node">
      <span class="node-icon">ğŸ§ </span>
      <div class="node-label">Claude API</div>
      <div class="node-sub">Intelligence</div>
    </div>
  </div>

  <!-- Tech Layers -->
  <div class="section-title">Technology Layers</div>
  <div class="layers">

    <!-- Frontend -->
    <div class="layer-card frontend">
      <div class="layer-header">
        <div class="layer-icon">ğŸ–¥ï¸</div>
        <div>
          <div class="layer-title">Frontend</div>
          <div class="layer-category">Customer & Admin Interfaces</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Next.js 14</span>
          <div class="tech-desc">Static export â€” fast, SEO-ready, zero server cost on cPanel</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">TypeScript</span>
          <div class="tech-desc">Type safety across the entire codebase</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Tailwind CSS</span>
          <div class="tech-desc">Utility-first styling, rapid UI iteration</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Chart.js</span>
          <div class="tech-desc">Analytics dashboards â€” revenue, orders, inventory charts</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Supabase Realtime</span>
          <div class="tech-desc">Live dashboard updates without page refresh</div>
        </div>
      </div>
    </div>

    <!-- Backend -->
    <div class="layer-card backend">
      <div class="layer-header">
        <div class="layer-icon">âš™ï¸</div>
        <div>
          <div class="layer-title">Backend & Database</div>
          <div class="layer-category">Data, Auth & Business Logic</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Supabase</span>
          <div class="tech-desc">PostgreSQL database, row-level security, auth</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Edge Functions</span>
          <div class="tech-desc">Serverless Deno functions for all backend logic</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Supabase Auth</span>
          <div class="tech-desc">JWT-based authentication for admin dashboard</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Supabase Cron</span>
          <div class="tech-desc">Scheduled jobs â€” daily summaries, inventory checks</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">PostgreSQL</span>
          <div class="tech-desc">Orders, customers, payments, inventory, deliveries</div>
        </div>
      </div>
    </div>

    <!-- AI Intelligence -->
    <div class="layer-card intelligence">
      <div class="layer-header">
        <div class="layer-icon">ğŸ§ </div>
        <div>
          <div class="layer-title">AI Intelligence</div>
          <div class="layer-category">Claude API + Automation</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Claude API</span>
          <div class="tech-desc">claude-sonnet-4-6 for all intelligence tasks</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Daily Summary</span>
          <div class="tech-desc">6 AM WhatsApp briefing â€” revenue, orders, alerts</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Anomaly Detect</span>
          <div class="tech-desc">M-Pesa payment mismatch analysis and flagging</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">WhatsApp Bot</span>
          <div class="tech-desc">Customer service automation, repeat order handling</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Data Insights</span>
          <div class="tech-desc">Natural language queries on business data</div>
        </div>
      </div>
    </div>

    <!-- Payments -->
    <div class="layer-card payments">
      <div class="layer-header">
        <div class="layer-icon">ğŸ’³</div>
        <div>
          <div class="layer-title">Payments</div>
          <div class="layer-category">M-Pesa & Reconciliation</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Daraja API</span>
          <div class="tech-desc">Safaricom M-Pesa STK Push â€” customer payments</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">STK Push</span>
          <div class="tech-desc">Direct payment prompt on customer's phone</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Auto-Reconcile</span>
          <div class="tech-desc">Edge Function matches payments to orders automatically</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Exception Queue</span>
          <div class="tech-desc">Unmatched payments flagged with Claude analysis</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Payment Ledger</span>
          <div class="tech-desc">Full audit trail in PostgreSQL payments table</div>
        </div>
      </div>
    </div>

    <!-- Communications -->
    <div class="layer-card comms">
      <div class="layer-header">
        <div class="layer-icon">ğŸ“²</div>
        <div>
          <div class="layer-title">Communications</div>
          <div class="layer-category">WhatsApp Automation</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Africa's Talking</span>
          <div class="tech-desc">Kenya-based WhatsApp Business API, M-Pesa friendly</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Order Confirm</span>
          <div class="tech-desc">Auto WhatsApp on new order â€” details + payment ref</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Pay Receipt</span>
          <div class="tech-desc">Instant confirmation when M-Pesa clears</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Delivery Alert</span>
          <div class="tech-desc">Driver name, ETA, and tracking link to customer</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Owner Alerts</span>
          <div class="tech-desc">Errors, exceptions, and daily summary to Edwin</div>
        </div>
      </div>
    </div>

    <!-- Metabase -->
    <div class="layer-card" style="border-top: 3px solid #3b82f6; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #eff6ff;">ğŸ“Š</div>
        <div>
          <div class="layer-title">Business Intelligence</div>
          <div class="layer-category">Metabase Â· Self-Hosted Analytics</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Metabase OSS</span>
          <div class="tech-desc">Self-hosted on Hetzner CX11 VPS â€” ~â‚¬4/mo (KSh 700)</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">analytics.*</span>
          <div class="tech-desc">analytics.enkanafresh.co.ke â€” SSL via Nginx + Certbot</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Supabase PG</span>
          <div class="tech-desc">Read-only connection via metabase_reader PostgreSQL user</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">5 Dashboards</span>
          <div class="tech-desc">Revenue, Customers, Operations, Inventory, Payments</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Scheduled Reports</span>
          <div class="tech-desc">Weekly Monday email â€” business summary to Edwin</div>
        </div>
      </div>
    </div>

    <!-- Cloudflare -->
    <div class="layer-card" style="border-top: 3px solid #f6821f; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #fff7ed;">ğŸ›¡ï¸</div>
        <div>
          <div class="layer-title">Edge & Security</div>
          <div class="layer-category">Cloudflare Â· Free Tier</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Cloudflare DNS</span>
          <div class="tech-desc">All subdomains managed â€” instant propagation</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">CDN + Cache</span>
          <div class="tech-desc">Static assets cached globally â€” faster Kenyan load times</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">DDoS Shield</span>
          <div class="tech-desc">Absorbs attacks before they reach cPanel</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">WAF Rules</span>
          <div class="tech-desc">Dashboard geo-locked to KE+UG Â· Safaricom IPs whitelisted</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">CF Workers</span>
          <div class="tech-desc">Edge validation of M-Pesa callbacks Â· Auto cache purge on deploy</div>
        </div>
      </div>
    </div>

    <!-- Backup & Recovery -->
    <div class="layer-card" style="border-top: 3px solid #ef4444; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #fef2f2;">ğŸ’¾</div>
        <div>
          <div class="layer-title">Backup & Recovery</div>
          <div class="layer-category">Disaster Recovery Â· Daily</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">DB Backups</span>
          <div class="tech-desc">Daily Supabase table exports to Storage bucket at 2 AM EAT</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">cPanel Backup</span>
          <div class="tech-desc">Automated daily file backups â€” 7-day retention</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Backup Alert</span>
          <div class="tech-desc">WhatsApp confirmation to Edwin on every successful backup</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Recovery RTĞ</span>
          <div class="tech-desc">Target: full system restoration in under 1 hour</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">RECOVERY.md</span>
          <div class="tech-desc">Step-by-step runbook in repo root for any failure scenario</div>
        </div>
      </div>
    </div>

    <!-- Staging -->
    <div class="layer-card" style="border-top: 3px solid #6366f1; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #eef2ff;">ğŸ§ª</div>
        <div>
          <div class="layer-title">Staging Environment</div>
          <div class="layer-category">Safe Testing Â· Pre-Production</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">staging.*</span>
          <div class="tech-desc">staging.enkanafresh.co.ke â€” mirrors production exactly</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Staging Branch</span>
          <div class="tech-desc">GitHub staging branch auto-deploys to staging subdomain</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Supabase Staging</span>
          <div class="tech-desc">Separate Supabase project â€” no risk to production data</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">PR Gate</span>
          <div class="tech-desc">All features must pass staging before merging to deploy</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">M-Pesa Sandbox</span>
          <div class="tech-desc">Daraja sandbox for payment testing without real money</div>
        </div>
      </div>
    </div>

    <!-- SEO & Performance -->
    <div class="layer-card" style="border-top: 3px solid #0ea5e9; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #f0f9ff;">ğŸ”</div>
        <div>
          <div class="layer-title">SEO & Performance</div>
          <div class="layer-category">Discoverability Â· Speed</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">next-seo</span>
          <div class="tech-desc">Meta tags, Open Graph, structured data for Google Kenya</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">JSON-LD Schema</span>
          <div class="tech-desc">LocalBusiness + FoodEstablishment schema markup</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">next-sitemap</span>
          <div class="tech-desc">Auto-generated sitemap.xml submitted to Google Search Console</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Core Web Vitals</span>
          <div class="tech-desc">Target all-green Lighthouse scores â€” optimised for Kenyan 4G</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">robots.txt</span>
          <div class="tech-desc">Dashboard + tracking routes blocked from search indexing</div>
        </div>
      </div>
    </div>

    <!-- Customer Portal -->
    <div class="layer-card" style="border-top: 3px solid #10b981; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #ecfdf5;">ğŸ“¦</div>
        <div>
          <div class="layer-title">Customer Portal</div>
          <div class="layer-category">Self-Service Order Tracking</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Order Tracker</span>
          <div class="tech-desc">enkanafresh.co.ke/track/[orderId] â€” no login needed</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Status Timeline</span>
          <div class="tech-desc">Visual step tracker: received â†’ paid â†’ prep â†’ delivery â†’ done</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">WhatsApp Link</span>
          <div class="tech-desc">Tracking URL sent automatically in every order WhatsApp</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Zero Auth</span>
          <div class="tech-desc">Order ID acts as token â€” no account creation friction</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Reduces WA Load</span>
          <div class="tech-desc">Eliminates "where is my order?" messages entirely</div>
        </div>
      </div>
    </div>

    <!-- QA & CI/CD -->
    <div class="layer-card" style="border-top: 3px solid #8b5cf6; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #fdf4ff;">âš™ï¸</div>
        <div>
          <div class="layer-title">QA & CI/CD</div>
          <div class="layer-category">GitHub Actions Â· Automated Quality</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">GitHub Actions</span>
          <div class="tech-desc">Full CI pipeline fires on every PR â€” lint, test, build, E2E</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Vitest</span>
          <div class="tech-desc">Unit tests â€” reconciliation logic, status transitions, validation</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Playwright</span>
          <div class="tech-desc">E2E browser tests â€” order flow, dashboard, tracking page</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">CodeRabbit</span>
          <div class="tech-desc">AI reviews every PR diff before human eyes touch it</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Biome + Dependabot</span>
          <div class="tech-desc">Linting, formatting, and weekly dependency security scans</div>
        </div>
      </div>
    </div>

    <!-- Security Hardening -->
    <div class="layer-card" style="border-top: 3px solid #dc2626; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #fef2f2;">ğŸ”</div>
        <div>
          <div class="layer-title">Security Hardening</div>
          <div class="layer-category">RLS Â· Validation Â· Rate Limits</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Supabase RLS</span>
          <div class="tech-desc">Row-level security policies on every table â€” explicit allow only</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Zod Validation</span>
          <div class="tech-desc">Schema validation on every Edge Function input â€” no raw data</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Rate Limiting</span>
          <div class="tech-desc">DB-backed rate limits per phone/IP on all write endpoints</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">HMAC Verify</span>
          <div class="tech-desc">M-Pesa callback signature verification â€” not just IP check</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Supabase Vault</span>
          <div class="tech-desc">All secrets encrypted at rest + 90-day rotation schedule</div>
        </div>
      </div>
    </div>

    <!-- Reliability -->
    <div class="layer-card" style="border-top: 3px solid #0891b2; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #ecfeff;">âš¡</div>
        <div>
          <div class="layer-title">Reliability</div>
          <div class="layer-category">Uptime Â· Idempotency Â· Indexes</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Better Uptime</span>
          <div class="tech-desc">External monitor â€” WhatsApp alert within 2 mins of downtime</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Health Endpoint</span>
          <div class="tech-desc">/functions/v1/health â€” checks DB + M-Pesa connectivity</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Idempotency</span>
          <div class="tech-desc">Duplicate M-Pesa callbacks handled safely â€” no double payments</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">DB Indexes</span>
          <div class="tech-desc">12 indexes on high-traffic columns â€” consistent query speed</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">API Versioning</span>
          <div class="tech-desc">All functions under /v1/ â€” safe to release /v2/ without breakage</div>
        </div>
      </div>
    </div>

    <!-- Compliance -->
    <div class="layer-card" style="border-top: 3px solid #065f46; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #ecfdf5;">âš–ï¸</div>
        <div>
          <div class="layer-title">Compliance</div>
          <div class="layer-category">Kenya Data Protection Act 2019</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">Privacy Policy</span>
          <div class="tech-desc">ODPC-compliant â€” data collected, retention periods, rights</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Terms of Service</span>
          <div class="tech-desc">Order terms, delivery, refunds â€” required for M-Pesa approval</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Consent Capture</span>
          <div class="tech-desc">Explicit checkbox + timestamp stored on every order</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Data Deletion</span>
          <div class="tech-desc">Auto-anonymise personal data 30 days after deletion request</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">ODPC Registration</span>
          <div class="tech-desc">Registered Data Controller â€” KSh 5,000 one-time fee</div>
        </div>
      </div>
    </div>

    <!-- Load Testing -->
    <div class="layer-card" style="border-top: 3px solid #d97706; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #fffbeb;">ğŸ‹ï¸</div>
        <div>
          <div class="layer-title">Performance Testing</div>
          <div class="layer-category">k6 Load Testing Â· Baseline</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">k6</span>
          <div class="tech-desc">Load tests against staging â€” run before every major launch</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">50 Concurrent</span>
          <div class="tech-desc">Target: handle 50 simultaneous orders without degradation</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">p95 < 2s</span>
          <div class="tech-desc">95th percentile response time under 2 seconds for all endpoints</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">PERFORMANCE.md</span>
          <div class="tech-desc">Baseline documented â€” re-tested after every major feature</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Query Monitor</span>
          <div class="tech-desc">Supabase Reports â€” weekly check for slow queries and seq scans</div>
        </div>
      </div>
    </div>

    <!-- Documentation -->
    <div class="layer-card" style="border-top: 3px solid #475569; background: white;">
      <div class="layer-header">
        <div class="layer-icon" style="background: #f8fafc;">ğŸ“š</div>
        <div>
          <div class="layer-title">Documentation & Flags</div>
          <div class="layer-category">README Â· Flagsmith Â· API Docs</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">README.md</span>
          <div class="tech-desc">New dev onboarding in under 1 hour â€” setup, commands, contacts</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">CLAUDE.md</span>
          <div class="tech-desc">Full project context, rules, stack, rotation schedule for Claude Code</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Flagsmith</span>
          <div class="tech-desc">Feature flags â€” roll out WhatsApp bot to 10% first, then 100%</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">JSDoc + TypeDoc</span>
          <div class="tech-desc">Auto-generated API docs from Edge Function comments</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">RECOVERY.md</span>
          <div class="tech-desc">Step-by-step runbook â€” full restoration under 1 hour from anything</div>
        </div>
      </div>
    </div>

    <!-- DevOps -->
    <div class="layer-card devops">
      <div class="layer-header">
        <div class="layer-icon">ğŸš€</div>
        <div>
          <div class="layer-title">DevOps & Tooling</div>
          <div class="layer-category">Development & Deployment</div>
        </div>
      </div>
      <div class="tech-list">
        <div class="tech-item">
          <span class="tech-badge">GitHub</span>
          <div class="tech-desc">Private repo, branch protection, PR reviews required</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">cPanel / SSH</span>
          <div class="tech-desc">Kenya Website Experts hosting â€” webhook auto-deploy</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Claude Code</span>
          <div class="tech-desc">AI-powered development in Cursor IDE</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Sentry</span>
          <div class="tech-desc">Error monitoring â€” alerts before customers notice</div>
        </div>
        <div class="tech-item">
          <span class="tech-badge">Cursor IDE</span>
          <div class="tech-desc">AI-first code editor replacing Replit</div>
        </div>
      </div>
    </div>

  </div>

  <!-- Data Flow -->
  <div class="section-title">Data Flow â€” Order to Delivery</div>
  <div class="dataflow">
    <div class="flow-diagram">

      <div class="flow-row">
        <div class="flow-box dark">
          ğŸ“± Customer Places Order
          <div class="fbox-sub">Web / WhatsApp Bot</div>
        </div>
      </div>

      <div class="v-connector">â†“</div>

      <div class="flow-cols">
        <div class="flow-box">
          âš¡ Next.js Frontend
          <div class="fbox-sub">Validates & submits</div>
        </div>
        <div class="flow-box gold">
          ğŸ’³ M-Pesa STK Push
          <div class="fbox-sub">Daraja API triggers payment</div>
        </div>
        <div class="flow-box">
          ğŸ—„ï¸ Supabase Insert
          <div class="fbox-sub">Order saved to DB</div>
        </div>
      </div>

      <div class="v-connector">â†“</div>

      <div class="flow-cols">
        <div class="flow-box">
          ğŸ”„ Auto-Reconcile
          <div class="fbox-sub">Payment matched to order</div>
        </div>
        <div class="flow-box purple">
          ğŸ§  Claude Analysis
          <div class="fbox-sub">Anomaly check if mismatch</div>
        </div>
        <div class="flow-box">
          ğŸ“² WhatsApp Confirm
          <div class="fbox-sub">Africa's Talking fires</div>
        </div>
      </div>

      <div class="v-connector">â†“</div>

      <div class="flow-cols">
        <div class="flow-box">
          ğŸ“¦ Order Prepared
          <div class="fbox-sub">Dashboard status update</div>
        </div>
        <div class="flow-box gold">
          ğŸšš Dispatch + Alert
          <div class="fbox-sub">Driver assigned, customer notified</div>
        </div>
        <div class="flow-box">
          âœ… Delivered
          <div class="fbox-sub">Status closed, inventory deducted</div>
        </div>
      </div>

      <div class="v-connector">â†“</div>

      <div class="flow-cols">
        <div class="flow-box purple">
          ğŸ“Š Metabase BI
          <div class="fbox-sub">analytics.enkanafresh.co.ke</div>
        </div>
        <div class="flow-box gold">
          ğŸ“ˆ 5 Dashboards
          <div class="fbox-sub">Revenue Â· Customers Â· Ops Â· Inventory Â· Payments</div>
        </div>
        <div class="flow-box">
          ğŸ“§ Weekly Report
          <div class="fbox-sub">Auto-emailed to Edwin every Monday</div>
        </div>
      </div>

      <div class="v-connector">â†“</div>

      <div class="flow-row">
        <div class="flow-box purple">
          ğŸ§  Claude Daily Summary â†’ Edwin's WhatsApp (6 AM)
          <div class="fbox-sub">Revenue Â· Pending orders Â· Delivery schedule Â· Anomalies</div>
        </div>
      </div>

    </div>
  </div>

  <!-- Monthly Cost -->
  <div class="cost-section">
    <div class="section-title">Monthly Infrastructure Cost</div>
    <div class="cost-grid">
      <div class="cost-item">
        <div class="cost-service">Claude Pro (Ã—2)</div>
        <div class="cost-amount">$40</div>
        <div class="cost-period">Edwin + Dev subscription</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">Supabase</div>
        <div class="cost-amount">$0â€“25</div>
        <div class="cost-period">Free tier covers current scale</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">Claude API</div>
        <div class="cost-amount">~$10</div>
        <div class="cost-period">Intelligence features usage</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">Africa's Talking</div>
        <div class="cost-amount">~KSh 1.5K</div>
        <div class="cost-period">WhatsApp messages</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">cPanel Hosting</div>
        <div class="cost-amount">~KSh 2K</div>
        <div class="cost-period">Kenya Website Experts</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">Sentry</div>
        <div class="cost-amount">$0</div>
        <div class="cost-period">Free tier sufficient</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">Cursor IDE</div>
        <div class="cost-amount">$0â€“20</div>
        <div class="cost-period">Free tier or Pro</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">Cloudflare</div>
        <div class="cost-amount">$0</div>
        <div class="cost-period">Free tier â€” fully sufficient</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">Hetzner VPS</div>
        <div class="cost-amount">â‚¬4</div>
        <div class="cost-period">Metabase Â· ~KSh 700/mo</div>
      </div>
      <div class="cost-item">
        <div class="cost-service">GitHub</div>
        <div class="cost-amount">$0</div>
        <div class="cost-period">Free private repos</div>
      </div>
    </div>
    <div class="cost-total">
      <div class="cost-total-label">Total Monthly Stack Cost</div>
      <div class="cost-total-amount">~$84 + KSh 4.2K</div>
    </div>
    <div class="cost-note">â‰ˆ KSh 14,200/mo Â· 20 phases Â· Bulletproof Â· 10/10 across Security, Reliability, Observability, Compliance, Performance, Developer Experience, AI Intelligence, Payments, Customer Experience & Business Intelligence</div>
  </div>

  <!-- Design Principles -->
  <div class="section-title">Why This Is Bulletproof â€” 20 Phases, 10/10 Every Dimension</div>
  <div class="principles">
    <div class="principle" data-num="01">
      <div class="principle-title">Edge-First Security</div>
      <div class="principle-desc">Cloudflare WAF + Supabase RLS + Zod validation + HMAC signature verification + rate limiting + Supabase Vault. Five independent security layers. An attacker must breach all five.</div>
    </div>
    <div class="principle" data-num="02">
      <div class="principle-title">Zero Silent Failures</div>
      <div class="principle-desc">Sentry catches app errors. Better Uptime catches downtime. Idempotent webhooks prevent double payments. Daily WhatsApp backup confirmation. Nothing fails quietly.</div>
    </div>
    <div class="principle" data-num="03">
      <div class="principle-title">Kenya-Native by Design</div>
      <div class="principle-desc">M-Pesa is the only payment method. Africa's Talking for WhatsApp. Cloudflare edge nodes closer to Nairobi. Dashboard geo-locked to KE+UG. ODPC-compliant.</div>
    </div>
    <div class="principle" data-num="04">
      <div class="principle-title">AI at Every Layer</div>
      <div class="principle-desc">Claude API in Edge Functions for anomaly detection, daily summaries, and WhatsApp chatbot. CodeRabbit reviews every PR. Feature flags control rollout risk.</div>
    </div>
    <div class="principle" data-num="05">
      <div class="principle-title">Safe to Ship Fast</div>
      <div class="principle-desc">Staging mirrors production. CI pipeline runs in 5 minutes. Branch protection blocks bad merges. Load tested before launch. Any developer can onboard in 1 hour.</div>
    </div>
    <div class="principle" data-num="06">
      <div class="principle-title">Recoverable from Anything</div>
      <div class="principle-desc">Daily encrypted backups with WhatsApp confirmation. Point-in-time Supabase restore. Cloudflare DNS failover. Full recovery runbook in repo. Target RTO: under 1 hour.</div>
    </div>
  </div>

</div>
</body>
</html>
